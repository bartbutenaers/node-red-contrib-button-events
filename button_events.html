<!--
  Copyright 2020, Bart Butenaers
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<script type="text/javascript">
(function() {
    RED.nodes.registerType('button-events',{
        category: 'function',
        color: '#E9967A',
        defaults: {
            name: {value:""},      
            inputField: {value: "payload", required: true, validate: RED.validators.typedInput("inputFieldType")},
            inputFieldType: {value: "msg"},
            outputField: {value: "payload", required: true, validate: RED.validators.typedInput("outputFieldType")},
            outputFieldType: {value: "msg"},
            idleValue : {value: "1"},
            clickedInterval: {value: 200},
            pressedInterval: {value: 200},
            debounceInterval: {value: 30},
            triggerPressed: {value: true},
            triggerClicked: {value: true},
            triggerClickedPressed: {value: true},
            triggerDoubleClicked: {value: true},
            triggerReleased: {value: true},
            buttonChanged: {value: false},
            buttonPress: {value: false},
            buttonRelease: {value: false}
        },        
        inputs:1,
        outputs:1,
        icon: "font-awesome/fa-barcode",
        label: function() {
            return this.name || "Button events";
        },
        oneditprepare: function() {
            var node = this;
            debugger
            $('#node-input-inputField').typedInput({
                typeField: $("#node-input-inputFieldType"),
                types: ['msg']
            });
            $('#node-input-outputField').typedInput({
                typeField: $("#node-input-outputFieldType"),
                types: ['msg']
            });
        },
        oneditsave: function() {
            var node = this;

        }
    });
})();
</script>

<script type="text/x-red" data-template-name="button-events">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <br>
    <div class="form-row">
        <label style="padding-top: 8px" for="node-input-inputField"><i class="fa fa-sign-in"></i> Input</label>
        <input type="text" id="node-input-inputField" style="width:70%">
        <input type="hidden" id="node-input-inputFieldType">
    </div>
    <div class="form-row">
        <label style="padding-top: 8px" for="node-input-outputField"><i class="fa fa-sign-in"></i> Output</label>
        <input type="text" id="node-input-outputField" style="width:70%">
        <input type="hidden" id="node-input-outputFieldType">
    </div>
    <div class="form-row">
        <label for="node-input-clickedInterval"><i class="fa fa-table"></i> Clicked</span></label>
        <input type="number" id="node-input-clickedInterval">
    </div>
    <div class="form-row">
        <label for="node-input-pressedInterval"><i class="fa fa-table"></i> Pressed</span></label>
        <input type="number" id="node-input-pressedInterval">
    </div>
    <div class="form-row">
        <label for="node-input-debounceInterval"><i class="fa fa-table"></i> Debounce</span></label>
        <input type="number" id="node-input-debounceInterval">
    </div>
    <div class="form-row">
        <label for="node-input-idleValue"><i class="fa fa-list"></i> Idle value</label>
        <select id="node-input-idleValue">
            <option value="1">1 (high/pullup)</option>
            <option value="0">0 (low/pulldown)</option>
        </select>
    </div>
    <br>
    <div class="form-row">    
        <input type="checkbox" id="node-input-triggerPressed" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-triggerPressed" style="width:70%;"> Trigger the "pressed" user intent event</label>
    </div>
    <div class="form-row">    
        <input type="checkbox" id="node-input-triggerClicked" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-triggerClicked" style="width:70%;"> Trigger the "clicked" user intent event</label>
    </div>    
    <div class="form-row">    
        <input type="checkbox" id="node-input-triggerClickedPressed" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-triggerClickedPressed" style="width:70%;"> Trigger the "clicked_pressed" user intent event</label>
    </div>      
    <div class="form-row">    
        <input type="checkbox" id="node-input-triggerDoubleClicked" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-triggerDoubleClicked" style="width:70%;"> Trigger the "double_clicked" user intent event</label>
    </div>      
    <div class="form-row">    
        <input type="checkbox" id="node-input-triggerReleased" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-triggerReleased" style="width:70%;"> Trigger the "released" user intent event</label>
    </div>    
    <br>
    <div class="form-row">    
        <input type="checkbox" id="node-input-buttonChanged" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-buttonChanged" style="width:70%;"> Trigger the "button_changed" internal event</label>
    </div> 
    <div class="form-row">    
        <input type="checkbox" id="node-input-buttonPress" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-buttonPress" style="width:70%;"> Trigger the "button_press" internal event</label>
    </div> 
    <div class="form-row">    
        <input type="checkbox" id="node-input-buttonRelease" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-buttonRelease" style="width:70%;"> Trigger the "button_release" internal event</label>
    </div> 
</script>

<script type="text/x-red" data-help-name="button-events">
    <p>A Node-RED node to send events based on button actions.</p>
    <p>When a <code>0</code> or <code>1</code> arrives in the input msg, then the detected event will be send in the output msg:
        <ul>
            <li><b><i>pressed</i></b>: when a button is pressed and held down. This will be followed with a <code>released</code> event, as soon as the button is released.</li>
            <li><b><i>clicked</i></b>: when a button is pressed and released rapidly.</li>
            <li><b><i>clicked_pressed</i></b>: when a click is quickly followed by pressing and holding the button.  This will be followed by a <code>released</code> event, as soon as the button is released.</li>
            <li><b><i>double_clicked</i></b>: when a click is quickly followed with another click.</li>
            <li><b><i>released</i></b>: when the pressed button is released.</li>
        </ul>
    </p>
    <p><strong>Input:</strong><br/>	
    The input message field where the input value (0 or 1) will arrive.</p>
    <p><strong>Output:</strong><br/>	
    The output message field where the detected event type will be stored.</p>
    <p><strong>Clicked:</strong><br/>	
    The interval (in milliseconds) to wait - after a button is released - before generating a <code>clicked</code> event.</p>
    <p><strong>Pressed:</strong><br/>	
    The interval (in milliseconds) to wait - after a button is pressed - before generating a <code>pressed</code> event.</p>
    <p><strong>Debounce:</strong><br/>	
    The interval (in milliseconds) to wait before considering the input signal to have stabilized.</p>
    <p><strong>Idle value:</strong><br/>	
    The idle value of the input, i.e. the value of the signal when the button is not being pressed.  This can be <code>1</code> when the GPIO input has a pull-up resistor, or <code>0</code> in case of a pull-down resistor.</p>
</script>
